<!DOCTYPE html>
<html>
<head>
<title>
TEST
</title>
<meta charset="utf-8">
<style>
 body {margin:3%;}
 tw-storydata {display:none;}
 span#stats {font-style:italic;}
 input#omitTags {width:30%;}
 label {white-space:nowrap;}
 div#notes {font-size:smaller;width:45%;padding-top:20px;float:right;}
</style>

</head>
<body>
	<h1>DotScap Proofing Format</h1>
	<div>
		<a href="http://mcdemarco.net/tools/scree/dotscap">DotScap</a> should automatically generate and download your Scapple file to your computer.  If that doesn't happen and you are not prompted to download a file, you may need to try a different browser.  The Scapple file will be generated with the default options; to set your own options, ignore the initial download, change options, and press the Regenerate File button below.
	</div>
	<h2>Graph</h2>
	<div id="notes">
		<b>Notes:</b> Thicker borders appear on the start node, any unreachable nodes, and other detected nodes of note.  Traced nodes are colored blue regardless of the other color settings.  When color by length is on, all other nodes are colored in shades of red (shorter than average) to green (longer than average) based on the relative length of their contents.<br/>  Tag options use the first tag on each passage unless Use last tag is checked; optionally detected special tags are ignored in this ordering.  The omit by tag(s) option omits the passage regardless of tag order.  Stray or misplaced nodes can result from the omit tags setting, or from duplicate passage names or other linking issues.
	</div>
	<div>
		<span id="stats" title="Twine">
			<span id="nodeCount">0</span>&nbsp;nodes<span id="omitCount"></span>,
			<span id="leafCount">0</span>&nbsp;leaves<span id="looseCount"></span>,
			<span id="linkCount">0</span>&nbsp;links, and
			<span id="average">0</span>&nbsp;links&nbsp;per&nbsp;node.
		</span><br/>
		<form id="settingsForm">
		</form>
		<button type="button" id="saveScapButton">Regenerate File</button><br/>
	</div>

<tw-storydata name="TEST" startnode="2" creator="Twee2" creator-version="0.5.0" ifid="044752a6-8fdc-4aaa-b3c0-532e098421d1" format="/Users/mcd/Programming/js/got/hg/dotscap/dist/Twine2/DotScap/" options=""><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css"></style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-passagedata pid="1" name="StorySettings" tags="" position=""></tw-passagedata><tw-passagedata pid="2" name="Start" tags="" position="150,150">The internal title of the starting scene should be Start.  It's written in plain text, with only markdown-style formatting allowed.

This scene ends with some choices, to which we navigate using internal names for the linked scenes:

* Go to [[Scene 2]].
* Go to [[The End]].</tw-passagedata><tw-passagedata pid="3" name="Scene 2" tags="" position="250,250">This scene offers readers some more choices.  They can [[go back to a previous scene using an inline, descriptive link-&gt;Start]], a short inline link like [[Start]], or with links at the end like they saw before.

* Go back to [[Start]].
* Go on to [[Scene 3]].
* [[You can also go to the next section using a descriptive title for the reader.-&gt;Scene 3]]
* [[Scene 2a&lt;-You can format the longer link in either direction.]]
* Go to [[The End]].</tw-passagedata><tw-passagedata pid="4" name="Scene 2a" tags="" position="350,350">A digression.

* Go back to [[Scene 2]].</tw-passagedata><tw-passagedata pid="5" name="Scene 3" tags="" position="450,450">Feel free to structure your story in Scrivener as you wish.  You can put all your scenes at the top level, or divide them into sections and even subsections.  All text sections will be complied into story nodes.  Any folder names and notes will be ignored.

* Read about [[story formats|Scene 4]].
* Go to [[The End]].</tw-passagedata><tw-passagedata pid="6" name="Scene 4" tags="" position="550,550">Twine's story formats control the final appearance of your story, as well as any gamebook scripting (e.g., variables to track your character's hit points or inventory, etc.), even down to the details of italics and indentation.  

Most story formats use Markdown formatting, e.g., single asterisks to indicate *italics*, double asterisks for **boldface**, and double tildes for ~~strikethrough~~.

Some story formats, such as SugarCube, use their own formatting language.  SugarCube formatting is based on TiddlyWiki markup, and uses double slashes for //italics//, double apostrophes for ''boldface'', and double underscores for __underlining__.

* Go on to [[The End]].</tw-passagedata><tw-passagedata pid="7" name="The End" tags="End" position="650,650">The End is nigh!

''The end.''</tw-passagedata></tw-storydata>

<script>(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var saveAs=saveAs||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,i=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),c=e.webkitRequestFileSystem,s=e.requestFileSystem||c||e.mozRequestFileSystem,d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},f=0,u=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},l=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){d(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["ï»¿",e],{type:e.type}):e},v=function(t,d,v){v||(t=p(t));var w,y,m,S=this,h=t.type,R=!1,O=function(){l(S,"writestart progress write writeend".split(" "))},g=function(){if(y&&a&&"undefined"!=typeof FileReader){var o=new FileReader;return o.onloadend=function(){var e=o.result;y.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),S.readyState=S.DONE,O()},o.readAsDataURL(t),void(S.readyState=S.INIT)}if(!R&&w||(w=n().createObjectURL(t)),y)y.location.href=w;else{void 0===e.open(w,"_blank")&&a&&(e.location.href=w)}S.readyState=S.DONE,O(),u(w)},b=function(e){return function(){if(S.readyState!==S.DONE)return e.apply(this,arguments)}},E={create:!0,exclusive:!1};return S.readyState=S.INIT,d||(d="download"),r?(w=n().createObjectURL(t),void setTimeout(function(){o.href=w,o.download=d,i(o),O(),u(w),S.readyState=S.DONE})):(e.chrome&&h&&"application/octet-stream"!==h&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,"application/octet-stream"),R=!0),c&&"download"!==d&&(d+=".download"),("application/octet-stream"===h||c)&&(y=e),s?(f+=t.size,void s(e.TEMPORARY,f,b(function(e){e.root.getDirectory("saved",E,b(function(e){var n=function(){e.getFile(d,E,b(function(e){e.createWriter(b(function(n){n.onwriteend=function(t){y.location.href=e.toURL(),S.readyState=S.DONE,l(S,"writeend",t),u(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&g()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=S["on"+e]}),n.write(t),S.abort=function(){n.abort(),S.readyState=S.DONE},S.readyState=S.WRITING}),g)}),g)};e.getFile(d,{create:!1},b(function(e){e.remove(),n()}),b(function(e){e.code===e.NOT_FOUND_ERR?n():g()}))}),g)}),g)):void g())},w=v.prototype,y=function(e,t,n){return new v(e,t,n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=p(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(w.abort=function(){var e=this;e.readyState=e.DONE,l(e,"abort")},w.readyState=w.INIT=0,w.WRITING=1,w.DONE=2,w.error=w.onwritestart=w.onprogress=w.onwrite=w.onabort=w.onerror=w.onwriteend=null,y)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});

},{}],2:[function(require,module,exports){
!function(){var n="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},r=n._,t=Array.prototype,e=Object.prototype,u="undefined"!=typeof Symbol?Symbol.prototype:null,i=t.push,o=t.slice,a=e.toString,c=e.hasOwnProperty,l=Array.isArray,f=Object.keys,s=Object.create,p=function(){},h=function(n){return n instanceof h?n:this instanceof h?void(this._wrapped=n):new h(n)};"undefined"==typeof exports||exports.nodeType?n._=h:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=h),exports._=h),h.VERSION="1.9.0";var v,y=function(n,r,t){if(void 0===r)return n;switch(null==t?3:t){case 1:return function(t){return n.call(r,t)};case 3:return function(t,e,u){return n.call(r,t,e,u)};case 4:return function(t,e,u,i){return n.call(r,t,e,u,i)}}return function(){return n.apply(r,arguments)}},d=function(n,r,t){return h.iteratee!==v?h.iteratee(n,r):null==n?h.identity:h.isFunction(n)?y(n,r,t):h.isObject(n)&&!h.isArray(n)?h.matcher(n):h.property(n)};h.iteratee=v=function(n,r){return d(n,r,1/0)};var g=function(n,r){return r=null==r?n.length-1:+r,function(){for(var t=Math.max(arguments.length-r,0),e=Array(t),u=0;u<t;u++)e[u]=arguments[u+r];switch(r){case 0:return n.call(this,e);case 1:return n.call(this,arguments[0],e);case 2:return n.call(this,arguments[0],arguments[1],e)}var i=Array(r+1);for(u=0;u<r;u++)i[u]=arguments[u];return i[r]=e,n.apply(this,i)}},m=function(n){if(!h.isObject(n))return{};if(s)return s(n);p.prototype=n;var r=new p;return p.prototype=null,r},b=function(n){return function(r){return null==r?void 0:r[n]}},j=function(n,r){for(var t=r.length,e=0;e<t;e++){if(null==n)return;n=n[r[e]]}return t?n:void 0},x=Math.pow(2,53)-1,_=b("length"),A=function(n){var r=_(n);return"number"==typeof r&&r>=0&&r<=x};h.each=h.forEach=function(n,r,t){r=y(r,t);var e,u;if(A(n))for(e=0,u=n.length;e<u;e++)r(n[e],e,n);else{var i=h.keys(n);for(e=0,u=i.length;e<u;e++)r(n[i[e]],i[e],n)}return n},h.map=h.collect=function(n,r,t){r=d(r,t);for(var e=!A(n)&&h.keys(n),u=(e||n).length,i=Array(u),o=0;o<u;o++){var a=e?e[o]:o;i[o]=r(n[a],a,n)}return i};var w=function(n){var r=function(r,t,e,u){var i=!A(r)&&h.keys(r),o=(i||r).length,a=n>0?0:o-1;for(u||(e=r[i?i[a]:a],a+=n);a>=0&&a<o;a+=n){var c=i?i[a]:a;e=t(e,r[c],c,r)}return e};return function(n,t,e,u){var i=arguments.length>=3;return r(n,y(t,u,4),e,i)}};h.reduce=h.foldl=h.inject=w(1),h.reduceRight=h.foldr=w(-1),h.find=h.detect=function(n,r,t){var e=A(n)?h.findIndex:h.findKey,u=e(n,r,t);if(void 0!==u&&-1!==u)return n[u]},h.filter=h.select=function(n,r,t){var e=[];return r=d(r,t),h.each(n,function(n,t,u){r(n,t,u)&&e.push(n)}),e},h.reject=function(n,r,t){return h.filter(n,h.negate(d(r)),t)},h.every=h.all=function(n,r,t){r=d(r,t);for(var e=!A(n)&&h.keys(n),u=(e||n).length,i=0;i<u;i++){var o=e?e[i]:i;if(!r(n[o],o,n))return!1}return!0},h.some=h.any=function(n,r,t){r=d(r,t);for(var e=!A(n)&&h.keys(n),u=(e||n).length,i=0;i<u;i++){var o=e?e[i]:i;if(r(n[o],o,n))return!0}return!1},h.contains=h.includes=h.include=function(n,r,t,e){return A(n)||(n=h.values(n)),("number"!=typeof t||e)&&(t=0),h.indexOf(n,r,t)>=0},h.invoke=g(function(n,r,t){var e,u;return h.isFunction(r)?u=r:h.isArray(r)&&(e=r.slice(0,-1),r=r[r.length-1]),h.map(n,function(n){var i=u;if(!i){if(e&&e.length&&(n=j(n,e)),null==n)return;i=n[r]}return null==i?i:i.apply(n,t)})}),h.pluck=function(n,r){return h.map(n,h.property(r))},h.where=function(n,r){return h.filter(n,h.matcher(r))},h.findWhere=function(n,r){return h.find(n,h.matcher(r))},h.max=function(n,r,t){var e,u,i=-1/0,o=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof n[0]&&null!=n){n=A(n)?n:h.values(n);for(var a=0,c=n.length;a<c;a++)null!=(e=n[a])&&e>i&&(i=e)}else r=d(r,t),h.each(n,function(n,t,e){((u=r(n,t,e))>o||u===-1/0&&i===-1/0)&&(i=n,o=u)});return i},h.min=function(n,r,t){var e,u,i=1/0,o=1/0;if(null==r||"number"==typeof r&&"object"!=typeof n[0]&&null!=n){n=A(n)?n:h.values(n);for(var a=0,c=n.length;a<c;a++)null!=(e=n[a])&&e<i&&(i=e)}else r=d(r,t),h.each(n,function(n,t,e){((u=r(n,t,e))<o||u===1/0&&i===1/0)&&(i=n,o=u)});return i},h.shuffle=function(n){return h.sample(n,1/0)},h.sample=function(n,r,t){if(null==r||t)return A(n)||(n=h.values(n)),n[h.random(n.length-1)];var e=A(n)?h.clone(n):h.values(n),u=_(e);r=Math.max(Math.min(r,u),0);for(var i=u-1,o=0;o<r;o++){var a=h.random(o,i),c=e[o];e[o]=e[a],e[a]=c}return e.slice(0,r)},h.sortBy=function(n,r,t){var e=0;return r=d(r,t),h.pluck(h.map(n,function(n,t,u){return{value:n,index:e++,criteria:r(n,t,u)}}).sort(function(n,r){var t=n.criteria,e=r.criteria;if(t!==e){if(t>e||void 0===t)return 1;if(t<e||void 0===e)return-1}return n.index-r.index}),"value")};var O=function(n,r){return function(t,e,u){var i=r?[[],[]]:{};return e=d(e,u),h.each(t,function(r,u){var o=e(r,u,t);n(i,r,o)}),i}};h.groupBy=O(function(n,r,t){h.has(n,t)?n[t].push(r):n[t]=[r]}),h.indexBy=O(function(n,r,t){n[t]=r}),h.countBy=O(function(n,r,t){h.has(n,t)?n[t]++:n[t]=1});var k=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;h.toArray=function(n){return n?h.isArray(n)?o.call(n):h.isString(n)?n.match(k):A(n)?h.map(n,h.identity):h.values(n):[]},h.size=function(n){return null==n?0:A(n)?n.length:h.keys(n).length},h.partition=O(function(n,r,t){n[t?0:1].push(r)},!0),h.first=h.head=h.take=function(n,r,t){if(!(null==n||n.length<1))return null==r||t?n[0]:h.initial(n,n.length-r)},h.initial=function(n,r,t){return o.call(n,0,Math.max(0,n.length-(null==r||t?1:r)))},h.last=function(n,r,t){if(!(null==n||n.length<1))return null==r||t?n[n.length-1]:h.rest(n,Math.max(0,n.length-r))},h.rest=h.tail=h.drop=function(n,r,t){return o.call(n,null==r||t?1:r)},h.compact=function(n){return h.filter(n,Boolean)};var S=function(n,r,t,e){e=e||[];for(var u=e.length,i=0,o=_(n);i<o;i++){var a=n[i];if(A(a)&&(h.isArray(a)||h.isArguments(a)))if(r)for(var c=0,l=a.length;c<l;)e[u++]=a[c++];else S(a,r,t,e),u=e.length;else t||(e[u++]=a)}return e};h.flatten=function(n,r){return S(n,r,!1)},h.without=g(function(n,r){return h.difference(n,r)}),h.uniq=h.unique=function(n,r,t,e){h.isBoolean(r)||(e=t,t=r,r=!1),null!=t&&(t=d(t,e));for(var u=[],i=[],o=0,a=_(n);o<a;o++){var c=n[o],l=t?t(c,o,n):c;r&&!t?(o&&i===l||u.push(c),i=l):t?h.contains(i,l)||(i.push(l),u.push(c)):h.contains(u,c)||u.push(c)}return u},h.union=g(function(n){return h.uniq(S(n,!0,!0))}),h.intersection=function(n){for(var r=[],t=arguments.length,e=0,u=_(n);e<u;e++){var i=n[e];if(!h.contains(r,i)){var o;for(o=1;o<t&&h.contains(arguments[o],i);o++);o===t&&r.push(i)}}return r},h.difference=g(function(n,r){return r=S(r,!0,!0),h.filter(n,function(n){return!h.contains(r,n)})}),h.unzip=function(n){for(var r=n&&h.max(n,_).length||0,t=Array(r),e=0;e<r;e++)t[e]=h.pluck(n,e);return t},h.zip=g(h.unzip),h.object=function(n,r){for(var t={},e=0,u=_(n);e<u;e++)r?t[n[e]]=r[e]:t[n[e][0]]=n[e][1];return t};var M=function(n){return function(r,t,e){t=d(t,e);for(var u=_(r),i=n>0?0:u-1;i>=0&&i<u;i+=n)if(t(r[i],i,r))return i;return-1}};h.findIndex=M(1),h.findLastIndex=M(-1),h.sortedIndex=function(n,r,t,e){t=d(t,e,1);for(var u=t(r),i=0,o=_(n);i<o;){var a=Math.floor((i+o)/2);t(n[a])<u?i=a+1:o=a}return i};var F=function(n,r,t){return function(e,u,i){var a=0,c=_(e);if("number"==typeof i)n>0?a=i>=0?i:Math.max(i+c,a):c=i>=0?Math.min(i+1,c):i+c+1;else if(t&&i&&c)return i=t(e,u),e[i]===u?i:-1;if(u!==u)return i=r(o.call(e,a,c),h.isNaN),i>=0?i+a:-1;for(i=n>0?a:c-1;i>=0&&i<c;i+=n)if(e[i]===u)return i;return-1}};h.indexOf=F(1,h.findIndex,h.sortedIndex),h.lastIndexOf=F(-1,h.findLastIndex),h.range=function(n,r,t){null==r&&(r=n||0,n=0),t||(t=r<n?-1:1);for(var e=Math.max(Math.ceil((r-n)/t),0),u=Array(e),i=0;i<e;i++,n+=t)u[i]=n;return u},h.chunk=function(n,r){if(null==r||r<1)return[];for(var t=[],e=0,u=n.length;e<u;)t.push(o.call(n,e,e+=r));return t};var E=function(n,r,t,e,u){if(!(e instanceof r))return n.apply(t,u);var i=m(n.prototype),o=n.apply(i,u);return h.isObject(o)?o:i};h.bind=g(function(n,r,t){if(!h.isFunction(n))throw new TypeError("Bind must be called on a function");var e=g(function(u){return E(n,e,r,this,t.concat(u))});return e}),h.partial=g(function(n,r){var t=h.partial.placeholder,e=function(){for(var u=0,i=r.length,o=Array(i),a=0;a<i;a++)o[a]=r[a]===t?arguments[u++]:r[a];for(;u<arguments.length;)o.push(arguments[u++]);return E(n,e,this,this,o)};return e}),h.partial.placeholder=h,h.bindAll=g(function(n,r){r=S(r,!1,!1);var t=r.length;if(t<1)throw new Error("bindAll must be passed function names");for(;t--;){var e=r[t];n[e]=h.bind(n[e],n)}}),h.memoize=function(n,r){var t=function(e){var u=t.cache,i=""+(r?r.apply(this,arguments):e);return h.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return t.cache={},t},h.delay=g(function(n,r,t){return setTimeout(function(){return n.apply(null,t)},r)}),h.defer=h.partial(h.delay,h,1),h.throttle=function(n,r,t){var e,u,i,o,a=0;t||(t={});var c=function(){a=!1===t.leading?0:h.now(),e=null,o=n.apply(u,i),e||(u=i=null)},l=function(){var l=h.now();a||!1!==t.leading||(a=l);var f=r-(l-a);return u=this,i=arguments,f<=0||f>r?(e&&(clearTimeout(e),e=null),a=l,o=n.apply(u,i),e||(u=i=null)):e||!1===t.trailing||(e=setTimeout(c,f)),o};return l.cancel=function(){clearTimeout(e),a=0,e=u=i=null},l},h.debounce=function(n,r,t){var e,u,i=function(r,t){e=null,t&&(u=n.apply(r,t))},o=g(function(o){if(e&&clearTimeout(e),t){var a=!e;e=setTimeout(i,r),a&&(u=n.apply(this,o))}else e=h.delay(i,r,this,o);return u});return o.cancel=function(){clearTimeout(e),e=null},o},h.wrap=function(n,r){return h.partial(r,n)},h.negate=function(n){return function(){return!n.apply(this,arguments)}},h.compose=function(){var n=arguments,r=n.length-1;return function(){for(var t=r,e=n[r].apply(this,arguments);t--;)e=n[t].call(this,e);return e}},h.after=function(n,r){return function(){if(--n<1)return r.apply(this,arguments)}},h.before=function(n,r){var t;return function(){return--n>0&&(t=r.apply(this,arguments)),n<=1&&(r=null),t}},h.once=h.partial(h.before,2),h.restArguments=g;var N=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],T=function(n,r){var t=I.length,u=n.constructor,i=h.isFunction(u)&&u.prototype||e,o="constructor";for(h.has(n,o)&&!h.contains(r,o)&&r.push(o);t--;)(o=I[t])in n&&n[o]!==i[o]&&!h.contains(r,o)&&r.push(o)};h.keys=function(n){if(!h.isObject(n))return[];if(f)return f(n);var r=[];for(var t in n)h.has(n,t)&&r.push(t);return N&&T(n,r),r},h.allKeys=function(n){if(!h.isObject(n))return[];var r=[];for(var t in n)r.push(t);return N&&T(n,r),r},h.values=function(n){for(var r=h.keys(n),t=r.length,e=Array(t),u=0;u<t;u++)e[u]=n[r[u]];return e},h.mapObject=function(n,r,t){r=d(r,t);for(var e=h.keys(n),u=e.length,i={},o=0;o<u;o++){var a=e[o];i[a]=r(n[a],a,n)}return i},h.pairs=function(n){for(var r=h.keys(n),t=r.length,e=Array(t),u=0;u<t;u++)e[u]=[r[u],n[r[u]]];return e},h.invert=function(n){for(var r={},t=h.keys(n),e=0,u=t.length;e<u;e++)r[n[t[e]]]=t[e];return r},h.functions=h.methods=function(n){var r=[];for(var t in n)h.isFunction(n[t])&&r.push(t);return r.sort()};var B=function(n,r){return function(t){var e=arguments.length;if(r&&(t=Object(t)),e<2||null==t)return t;for(var u=1;u<e;u++)for(var i=arguments[u],o=n(i),a=o.length,c=0;c<a;c++){var l=o[c];r&&void 0!==t[l]||(t[l]=i[l])}return t}};h.extend=B(h.allKeys),h.extendOwn=h.assign=B(h.keys),h.findKey=function(n,r,t){r=d(r,t);for(var e,u=h.keys(n),i=0,o=u.length;i<o;i++)if(e=u[i],r(n[e],e,n))return e};var R=function(n,r,t){return r in t};h.pick=g(function(n,r){var t={},e=r[0];if(null==n)return t;h.isFunction(e)?(r.length>1&&(e=y(e,r[1])),r=h.allKeys(n)):(e=R,r=S(r,!1,!1),n=Object(n));for(var u=0,i=r.length;u<i;u++){var o=r[u],a=n[o];e(a,o,n)&&(t[o]=a)}return t}),h.omit=g(function(n,r){var t,e=r[0];return h.isFunction(e)?(e=h.negate(e),r.length>1&&(t=r[1])):(r=h.map(S(r,!1,!1),String),e=function(n,t){return!h.contains(r,t)}),h.pick(n,e,t)}),h.defaults=B(h.allKeys,!0),h.create=function(n,r){var t=m(n);return r&&h.extendOwn(t,r),t},h.clone=function(n){return h.isObject(n)?h.isArray(n)?n.slice():h.extend({},n):n},h.tap=function(n,r){return r(n),n},h.isMatch=function(n,r){var t=h.keys(r),e=t.length;if(null==n)return!e;for(var u=Object(n),i=0;i<e;i++){var o=t[i];if(r[o]!==u[o]||!(o in u))return!1}return!0};var q,K;q=function(n,r,t,e){if(n===r)return 0!==n||1/n==1/r;if(null==n||null==r)return!1;if(n!==n)return r!==r;var u=typeof n;return("function"===u||"object"===u||"object"==typeof r)&&K(n,r,t,e)},K=function(n,r,t,e){n instanceof h&&(n=n._wrapped),r instanceof h&&(r=r._wrapped);var i=a.call(n);if(i!==a.call(r))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+n==""+r;case"[object Number]":return+n!=+n?+r!=+r:0==+n?1/+n==1/r:+n==+r;case"[object Date]":case"[object Boolean]":return+n==+r;case"[object Symbol]":return u.valueOf.call(n)===u.valueOf.call(r)}var o="[object Array]"===i;if(!o){if("object"!=typeof n||"object"!=typeof r)return!1;var c=n.constructor,l=r.constructor;if(c!==l&&!(h.isFunction(c)&&c instanceof c&&h.isFunction(l)&&l instanceof l)&&"constructor"in n&&"constructor"in r)return!1}t=t||[],e=e||[];for(var f=t.length;f--;)if(t[f]===n)return e[f]===r;if(t.push(n),e.push(r),o){if((f=n.length)!==r.length)return!1;for(;f--;)if(!q(n[f],r[f],t,e))return!1}else{var s,p=h.keys(n);if(f=p.length,h.keys(r).length!==f)return!1;for(;f--;)if(s=p[f],!h.has(r,s)||!q(n[s],r[s],t,e))return!1}return t.pop(),e.pop(),!0},h.isEqual=function(n,r){return q(n,r)},h.isEmpty=function(n){return null==n||(A(n)&&(h.isArray(n)||h.isString(n)||h.isArguments(n))?0===n.length:0===h.keys(n).length)},h.isElement=function(n){return!(!n||1!==n.nodeType)},h.isArray=l||function(n){return"[object Array]"===a.call(n)},h.isObject=function(n){var r=typeof n;return"function"===r||"object"===r&&!!n},h.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(n){h["is"+n]=function(r){return a.call(r)==="[object "+n+"]"}}),h.isArguments(arguments)||(h.isArguments=function(n){return h.has(n,"callee")});var z=n.document&&n.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof z&&(h.isFunction=function(n){return"function"==typeof n||!1}),h.isFinite=function(n){return!h.isSymbol(n)&&isFinite(n)&&!isNaN(parseFloat(n))},h.isNaN=function(n){return h.isNumber(n)&&isNaN(n)},h.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"===a.call(n)},h.isNull=function(n){return null===n},h.isUndefined=function(n){return void 0===n},h.has=function(n,r){if(!h.isArray(r))return null!=n&&c.call(n,r);for(var t=r.length,e=0;e<t;e++){var u=r[e];if(null==n||!c.call(n,u))return!1;n=n[u]}return!!t},h.noConflict=function(){return n._=r,this},h.identity=function(n){return n},h.constant=function(n){return function(){return n}},h.noop=function(){},h.property=function(n){return h.isArray(n)?function(r){return j(r,n)}:b(n)},h.propertyOf=function(n){return null==n?function(){}:function(r){return h.isArray(r)?j(n,r):n[r]}},h.matcher=h.matches=function(n){return n=h.extendOwn({},n),function(r){return h.isMatch(r,n)}},h.times=function(n,r,t){var e=Array(Math.max(0,n));r=y(r,t,1);for(var u=0;u<n;u++)e[u]=r(u);return e},h.random=function(n,r){return null==r&&(r=n,n=0),n+Math.floor(Math.random()*(r-n+1))},h.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},L=h.invert(D),P=function(n){var r=function(r){return n[r]},t="(?:"+h.keys(n).join("|")+")",e=RegExp(t),u=RegExp(t,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,r):n}};h.escape=P(D),h.unescape=P(L),h.result=function(n,r,t){h.isArray(r)||(r=[r]);var e=r.length;if(!e)return h.isFunction(t)?t.call(n):t;for(var u=0;u<e;u++){var i=null==n?void 0:n[r[u]];void 0===i&&(i=t,u=e),n=h.isFunction(i)?i.call(n):i}return n};var W=0;h.uniqueId=function(n){var r=++W+"";return n?n+r:r},h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\u2028|\u2029/g,V=function(n){return"\\"+J[n]};h.template=function(n,r,t){!r&&t&&(r=t),r=h.defaults({},r,h.templateSettings);var e=RegExp([(r.escape||C).source,(r.interpolate||C).source,(r.evaluate||C).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(r,t,e,o,a){return i+=n.slice(u,a).replace(U,V),u=a+r.length,t?i+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),r}),i+="';\n",r.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";var o;try{o=new Function(r.variable||"obj","_",i)}catch(n){throw n.source=i,n}var a=function(n){return o.call(this,n,h)};return a.source="function("+(r.variable||"obj")+"){\n"+i+"}",a},h.chain=function(n){var r=h(n);return r._chain=!0,r};var $=function(n,r){return n._chain?h(r).chain():r};h.mixin=function(n){return h.each(h.functions(n),function(r){var t=h[r]=n[r];h.prototype[r]=function(){var n=[this._wrapped];return i.apply(n,arguments),$(this,t.apply(h,n))}}),h},h.mixin(h),h.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var r=t[n];h.prototype[n]=function(){var t=this._wrapped;return r.apply(t,arguments),"shift"!==n&&"splice"!==n||0!==t.length||delete t[0],$(this,t)}}),h.each(["concat","join","slice"],function(n){var r=t[n];h.prototype[n]=function(){return $(this,r.apply(this._wrapped,arguments))}}),h.prototype.value=function(){return this._wrapped},h.prototype.valueOf=h.prototype.toJSON=h.prototype.value,h.prototype.toString=function(){return String(this._wrapped)},"function"==typeof define&&define.amd&&define("underscore",[],function(){return h})}();

},{}],3:[function(require,module,exports){
function bytesToUuid(e,t){var o=t||0,i=byteToHex;return i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]}for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);module.exports=bytesToUuid;

},{}],4:[function(require,module,exports){
"use strict";function md5(d){if("string"==typeof d){var m=unescape(encodeURIComponent(d));d=new Array(m.length);for(var f=0;f<m.length;f++)d[f]=m.charCodeAt(f)}return md5ToHexEncodedArray(wordsToMd5(bytesToWords(d),8*d.length))}function md5ToHexEncodedArray(d){var m,f,n,e=[],i=32*d.length,r="0123456789abcdef";for(m=0;m<i;m+=8)f=d[m>>5]>>>m%32&255,n=parseInt(r.charAt(f>>>4&15)+r.charAt(15&f),16),e.push(n);return e}function wordsToMd5(d,m){d[m>>5]|=128<<m%32,d[14+(m+64>>>9<<4)]=m;var f,n,e,i,r,t=1732584193,h=-271733879,g=-1732584194,o=271733878;for(f=0;f<d.length;f+=16)n=t,e=h,i=g,r=o,t=md5ff(t,h,g,o,d[f],7,-680876936),o=md5ff(o,t,h,g,d[f+1],12,-389564586),g=md5ff(g,o,t,h,d[f+2],17,606105819),h=md5ff(h,g,o,t,d[f+3],22,-1044525330),t=md5ff(t,h,g,o,d[f+4],7,-176418897),o=md5ff(o,t,h,g,d[f+5],12,1200080426),g=md5ff(g,o,t,h,d[f+6],17,-1473231341),h=md5ff(h,g,o,t,d[f+7],22,-45705983),t=md5ff(t,h,g,o,d[f+8],7,1770035416),o=md5ff(o,t,h,g,d[f+9],12,-1958414417),g=md5ff(g,o,t,h,d[f+10],17,-42063),h=md5ff(h,g,o,t,d[f+11],22,-1990404162),t=md5ff(t,h,g,o,d[f+12],7,1804603682),o=md5ff(o,t,h,g,d[f+13],12,-40341101),g=md5ff(g,o,t,h,d[f+14],17,-1502002290),h=md5ff(h,g,o,t,d[f+15],22,1236535329),t=md5gg(t,h,g,o,d[f+1],5,-165796510),o=md5gg(o,t,h,g,d[f+6],9,-1069501632),g=md5gg(g,o,t,h,d[f+11],14,643717713),h=md5gg(h,g,o,t,d[f],20,-373897302),t=md5gg(t,h,g,o,d[f+5],5,-701558691),o=md5gg(o,t,h,g,d[f+10],9,38016083),g=md5gg(g,o,t,h,d[f+15],14,-660478335),h=md5gg(h,g,o,t,d[f+4],20,-405537848),t=md5gg(t,h,g,o,d[f+9],5,568446438),o=md5gg(o,t,h,g,d[f+14],9,-1019803690),g=md5gg(g,o,t,h,d[f+3],14,-187363961),h=md5gg(h,g,o,t,d[f+8],20,1163531501),t=md5gg(t,h,g,o,d[f+13],5,-1444681467),o=md5gg(o,t,h,g,d[f+2],9,-51403784),g=md5gg(g,o,t,h,d[f+7],14,1735328473),h=md5gg(h,g,o,t,d[f+12],20,-1926607734),t=md5hh(t,h,g,o,d[f+5],4,-378558),o=md5hh(o,t,h,g,d[f+8],11,-2022574463),g=md5hh(g,o,t,h,d[f+11],16,1839030562),h=md5hh(h,g,o,t,d[f+14],23,-35309556),t=md5hh(t,h,g,o,d[f+1],4,-1530992060),o=md5hh(o,t,h,g,d[f+4],11,1272893353),g=md5hh(g,o,t,h,d[f+7],16,-155497632),h=md5hh(h,g,o,t,d[f+10],23,-1094730640),t=md5hh(t,h,g,o,d[f+13],4,681279174),o=md5hh(o,t,h,g,d[f],11,-358537222),g=md5hh(g,o,t,h,d[f+3],16,-722521979),h=md5hh(h,g,o,t,d[f+6],23,76029189),t=md5hh(t,h,g,o,d[f+9],4,-640364487),o=md5hh(o,t,h,g,d[f+12],11,-421815835),g=md5hh(g,o,t,h,d[f+15],16,530742520),h=md5hh(h,g,o,t,d[f+2],23,-995338651),t=md5ii(t,h,g,o,d[f],6,-198630844),o=md5ii(o,t,h,g,d[f+7],10,1126891415),g=md5ii(g,o,t,h,d[f+14],15,-1416354905),h=md5ii(h,g,o,t,d[f+5],21,-57434055),t=md5ii(t,h,g,o,d[f+12],6,1700485571),o=md5ii(o,t,h,g,d[f+3],10,-1894986606),g=md5ii(g,o,t,h,d[f+10],15,-1051523),h=md5ii(h,g,o,t,d[f+1],21,-2054922799),t=md5ii(t,h,g,o,d[f+8],6,1873313359),o=md5ii(o,t,h,g,d[f+15],10,-30611744),g=md5ii(g,o,t,h,d[f+6],15,-1560198380),h=md5ii(h,g,o,t,d[f+13],21,1309151649),t=md5ii(t,h,g,o,d[f+4],6,-145523070),o=md5ii(o,t,h,g,d[f+11],10,-1120210379),g=md5ii(g,o,t,h,d[f+2],15,718787259),h=md5ii(h,g,o,t,d[f+9],21,-343485551),t=safeAdd(t,n),h=safeAdd(h,e),g=safeAdd(g,i),o=safeAdd(o,r);return[t,h,g,o]}function bytesToWords(d){var m,f=[];for(f[(d.length>>2)-1]=void 0,m=0;m<f.length;m+=1)f[m]=0;var n=8*d.length;for(m=0;m<n;m+=8)f[m>>5]|=(255&d[m/8])<<m%32;return f}function safeAdd(d,m){var f=(65535&d)+(65535&m);return(d>>16)+(m>>16)+(f>>16)<<16|65535&f}function bitRotateLeft(d,m){return d<<m|d>>>32-m}function md5cmn(d,m,f,n,e,i){return safeAdd(bitRotateLeft(safeAdd(safeAdd(m,d),safeAdd(n,i)),e),f)}function md5ff(d,m,f,n,e,i,r){return md5cmn(m&f|~m&n,d,m,e,i,r)}function md5gg(d,m,f,n,e,i,r){return md5cmn(m&n|f&~n,d,m,e,i,r)}function md5hh(d,m,f,n,e,i,r){return md5cmn(m^f^n,d,m,e,i,r)}function md5ii(d,m,f,n,e,i,r){return md5cmn(f^(m|~n),d,m,e,i,r)}module.exports=md5;

},{}],5:[function(require,module,exports){
function uuidToBytes(r){var e=[];return r.replace(/[a-fA-F0-9]{2}/g,function(r){e.push(parseInt(r,16))}),e}function stringToBytes(r){r=unescape(encodeURIComponent(r));for(var e=new Array(r.length),t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}var bytesToUuid=require("./bytesToUuid");module.exports=function(r,e,t){var n=function(r,n,a,o){var u=a&&o||0;if("string"==typeof r&&(r=stringToBytes(r)),"string"==typeof n&&(n=uuidToBytes(n)),!Array.isArray(r))throw TypeError("value must be an array of bytes");if(!Array.isArray(n)||16!==n.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var s=t(n.concat(r));if(s[6]=15&s[6]|e,s[8]=63&s[8]|128,a)for(var i=0;i<16;++i)a[u+i]=s[i];return a||bytesToUuid(s)};return n.name=r,n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n};

},{"./bytesToUuid":3}],6:[function(require,module,exports){
var v35=require("./lib/v35.js"),md5=require("./lib/md5");module.exports=v35("v3",48,md5);

},{"./lib/md5":4,"./lib/v35.js":5}],7:[function(require,module,exports){
var filesaver=require("filesaver.js-npm"),_=require("underscore"),uuidv3=require("uuid/v3"),dotScap={};!function(e){var t={checkpoint:!0,checkpointTag:"checkpoint",cluster:!1,color:"bw",countWords:!0,display:!0,ends:!0,endTag:"End",lastTag:!1,omitSpecialPassages:!0,omitTags:[],showNodeNames:!0,trace:"",palette:["#FEAF16","#2ED9FF","#DEA0FD","#FE00FA","#F7E1A0","#16FF32","#3283FE","#1C8356","#FBE426","#FA0087","#F8A19F","#1CBE4F","#C4451C","#C075A6","#90AD1C","#B00068","#AA0DFE","#FC1CBF","#1CFFCE","#F6222E","#85660D","#325A9B","#B10DA1","#A0A0A0","#782AB6","#565656"],paletteExceptions:{start:"#C8C8C8",ends:"#C8C8C8",unreachable:"#FF6666",untagged:"#FFFFFF",default:"#FFFFFF"}},n=["StoryTitle","StoryIncludes","StoryAuthor","StorySubtitle","StoryMenu","StorySettings","StoryColophon","StoryBanner","StoryCaption","StoryInit","StoryShare","PassageDone","PassageFooter","PassageHeader","PassageReady","MenuOptions","MenuShare"],o={title:"Untitled",startNode:1,startNodeName:"Start",leaves:0,links:0,tightEnds:0,avLength:1,maxLength:1,passages:[],reachable:[],tags:[],tagObject:[],targets:{},twineVersion:0};e.graph=function(){function n(){return s()}function a(){var e=n(),t=e,o=new Blob([t],{type:"application/xml;charset=utf-8"});filesaver.saveAs(o,"dotscap"+Date.now()+".scap",!0)}function r(e){e=e.split("#")[1];var t,n,o;return t=c(e.substring(0,2)),n=c(e.substring(2,4)),o=c(e.substring(4,6)),t+" "+n+" "+o}function c(e){return parseInt(e,16)/255}function s(){var t=[];return e.settings.parse(),e.story.parse(),t.push("<?xml version='1.0' encoding='UTF-8' standalone='no'?>"),t.push('<ScappleDocument ID="'+l()+'" Version="1.1">'),t.push("<Notes>"),t=t.concat(p()),t.push("</Notes>"),t.push("<BackgroundShapes/>"),t.push('<NoteStyles>\n      <Style AffectFontStyle="No" AffectAlignment="No" Name="Red Text" ID="1C10E977-4771-4213-A182-7C79298BC8D4" AffectTextColor="Yes" AffectNoteBody="No" AffectSticky="No" AffectSize="No" AffectFade="No">\n         <TextColor>1.0 0.0 0.0</TextColor>\n      </Style>\n      <Style AffectFontStyle="No" AffectAlignment="No" Name="Brown Bubble" ID="29849575-02E8-4B8E-9F81-25D227E055DF" AffectTextColor="No" AffectNoteBody="Yes" AffectSticky="No" AffectSize="No" AffectFade="No">\n         <BorderThickness>1</BorderThickness>\n         <BorderColor>0.269490 0.164034 0.186694</BorderColor>\n         <FillColor>0.934157 0.888319 0.785290</FillColor>\n      </Style>\n      <Style AffectFontStyle="No" AffectAlignment="No" Name="Green Bubble" ID="725C2580-333C-43FA-A038-099ED6E0F113" AffectTextColor="No" AffectNoteBody="Yes" AffectSticky="No" AffectSize="No" AffectFade="No">\n         <BorderThickness>1</BorderThickness>\n         <BorderColor>0.399100 0.583322 0.354864</BorderColor>\n         <FillColor>0.808835 0.872419 0.801343</FillColor>\n      </Style>\n      <Style AffectFontStyle="No" AffectAlignment="No" Name="Blue Bubble" ID="C4F75CFC-8C56-4F82-99AB-B348B56801BB" AffectTextColor="No" AffectNoteBody="Yes" AffectSticky="No" AffectSize="No" AffectFade="No">\n         <BorderThickness>1</BorderThickness>\n         <BorderColor>0.485893 0.568933 0.756207</BorderColor>\n         <FillColor>0.844068 0.869596 0.923064</FillColor>\n      </Style>\n      <Style AffectFontStyle="No" AffectAlignment="No" Name="Pink Bubble" ID="50D2426C-F754-4EBC-8D5B-9E83E229CAFC" AffectTextColor="No" AffectNoteBody="Yes" AffectSticky="No" AffectSize="No" AffectFade="No">\n         <BorderThickness>1</BorderThickness>\n         <BorderColor>0.690303 0.407263 0.550912</BorderColor>\n         <FillColor>0.898329 0.817472 0.865339</FillColor>\n      </Style>\n      <Style AffectFontStyle="No" AffectAlignment="No" Name="Yellow Bubble" ID="90442B24-E28F-41C9-91EA-CBB0A50D6450" AffectTextColor="No" AffectNoteBody="Yes" AffectSticky="No" AffectSize="No" AffectFade="No">\n         <BorderThickness>1</BorderThickness>\n         <BorderColor>0.769436 0.762219 0.390143</BorderColor>\n         <FillColor>0.912963 0.894118 0.644541</FillColor>\n      </Style>\n      <Style AffectFontStyle="Yes" AffectAlignment="Yes" Name="Title Text" ID="3F6B6120-67C6-4DC2-83E5-435D92327755" AffectTextColor="No" AffectNoteBody="No" AffectSticky="No" AffectSize="No" AffectFade="No">\n         <IsBold>Yes</IsBold>\n         <FontSize>12.0</FontSize>\n      </Style>\n   </NoteStyles>\n   <UISettings>\n      <BackgroundColor>1.0 0.988006 0.945006</BackgroundColor>\n      <DefaultFont>Helvetica</DefaultFont>\n      <DefaultTextColor>0.0 0.0 0.0</DefaultTextColor>\n      <LeftToRight>Yes</LeftToRight>\n   </UISettings>\n   <PrintSettings VerticalPagination="Auto" HorizontalPagination="Clip" Orientation="Portrait" RightMargin="12.000000" BottomMargin="12.000000" HorizontallyCentered="Yes" ScaleFactor="1.000000" PagesAcross="1" PaperType="na-letter" PagesDown="1" TopMargin="12.000000" Collates="Yes" PaperSize="-1.000000,-1.000000" LeftMargin="12.000000" VerticallyCentered="Yes"/>'),t.push("</ScappleDocument>"),t.join("\n")}function l(){return uuidv3("http://mcdemarco.net/tools/scree/dotscap",uuidv3.URL)}function d(e,t){return e||(e="0.934157 0.888319 0.78529"),t||(t=1),'<Appearance>\n\t\t\t<Alignment>Center</Alignment>\n\t\t\t<Border Weight="'+t+'" Style="Rounded">0.0 0.0 0.0</Border>\n\t\t\t<Fill>'+e+"</Fill>\n\t\t</Appearance>"}function u(e){return o.targets.hasOwnProperty(e)?o.targets[e]:m(e)}function g(e,n,o){var a;return a=(n?!t.showNodeNames:t.showNodeNames)?e.name:e.pid?e.pid:"Untitled Passage",o&&t.countWords&&(a+=" ("+e.wordCount+" word"+(1==e.wordCount?"":"s")+")"),m(a)}function p(){var e=[];for(i=0;i<o.passages.length;++i)o.passages[i].omit||(e=e.concat(h(o.passages[i])));return e}function h(e,n){var o=[];if(t.omitSpecialPassages&&e.special||e.omit)return o;var a=g(e),r=f(e,n),c=_.uniq(e.links.map(function(e){return u(e[0])}));return o.push('<Note Width="'+(8*a.length+20)+'" FontSize="16" ID="'+e.pid+'" Position="'+e.position+'">'),o.push(r),o.push("<String>"+a+"</String>"),o.push("<ConnectedNoteIDs>"+c.join(", ")+"</ConnectedNoteIDs>"),o.push("<PointsToNoteIDs>"+c.join(", ")+"</PointsToNoteIDs>"),o.push("</Note>"),o}function f(n,a){var c,i=1,s=0,l=n.pid,u=(n.content,n.theTag);if(n.trace&&i++,(l==o.startNode||_.find(o.unreachable,function(e){return e==n.name}))&&i++,t.ends&&e.passage.hasTag(n,t.endTag)&&i++,t.checkpoints&&e.passage.hasTag(n,t.checkpointTag),1==i&&0===n.links.length&&t.ends&&i++,n.trace)c="0.5 0.5 1";else if("bw"==t.color)c="1 1 1";else if("length"==t.color)s=Math.round(100*Math.min(1.75,n.textLength/o.avLength)/3)/100,s=Math.min(s,1),c=1-s+" "+s+" 0.1";else if("tag"==t.color&&u){var g=o.tags.indexOf(u);g>-1&&(s=t.palette[g%26]),c=r(s)}else c=r(l==o.startNode?t.paletteExceptions.start:t.ends&&e.passage.hasTag(n,t.endTag)?t.paletteExceptions.ends:_.find(o.unreachable,function(e){return e==n.name})?t.paletteExceptions.unreachable:"tag"==t.color?t.paletteExceptions.untagged:t.paletteExceptions.default);return d(c,i)}function m(e){return e&&(e=_.escape(e)),e}return{convert:n,saveScap:a}}(),e.init=function(){function t(){e.settings.load(),e.settings.write(),n(),e.graph.saveScap()}function n(){document.getElementById("settingsForm").addEventListener("click",e.graph.convert,!1),document.getElementById("omitTags").addEventListener("change",e.graph.convert,!1),document.getElementById("trace").addEventListener("change",e.graph.convert,!1),document.getElementById("saveScapButton").addEventListener("click",e.graph.saveScap,!1)}return{load:t}}(),e.passage=function(){function e(e,t){return e.tagArray.indexOf(t)>-1}function o(e,o){var c={},s=e.getAttribute("tags")?e.getAttribute("tags").trim().split(" "):[],l=i(e.innerText);return c.links=l,c.leaf=0===l.length,c.textLength=e.innerText.length,c.wordCount=e.innerText.trim()?e.innerText.trim().split(/\s+/).length:0,c.pid=e.getAttribute("pid")?e.getAttribute("pid"):o,c.tagArray=s,c.theTag=a(s),c.name=e.getAttribute("name")?e.getAttribute("name"):e.getAttribute("tiddler")?e.getAttribute("tiddler"):"Untitled Passage",c.special=n.indexOf(c.name)>-1,c.omit=r(c),c.trace=t.trace&&e.innerText.indexOf(t.trace)>-1,c.position=e.getAttribute("position")?e.getAttribute("position"):e.getAttribute("twine-position"),c}function a(e){var n=e.slice(0);return t.ends&&n.indexOf(t.endTag)>-1&&n.splice(n.indexOf(t.endTag),1),t.checkpoints&&n.indexOf(t.checkpointTag)>-1&&n.splice(n.indexOf(t.checkpointTag),1),n.length&&t.lastTag?n[n.length-1]:n.length?n[0]:""}function r(n){if(0==t.omitTags.length)return!1;for(var o=0;o<t.omitTags.length;o++)if(e(n,t.omitTags[o]))return!0;return!1}function c(e,t){var n=e.indexOf("|");if(-1!=n)e=e.substr(n+1);else{var o=e.indexOf("->");if(-1!=o)e=e.substr(o+2);else{var a=e.indexOf("<-");-1!=a&&(e=e.substr(0,a))}}return[e,t]}function i(e){var n,o,a,r=[],i=/\[\[(.*?)\]\]/g,s=/\<\<display \"(.*?)\"\>\>/g,l=/\(display: \"(.*?)\"\)/g;if(e){for(e=e.replace(/\/\*.*\*\//g,""),e=e.replace(/^\/\/.*(\r\n?|\n)/g,"");null!==(n=i.exec(e));)o=c(n[1],0),/^\w+:\/\/\/?\w/i.test(o)||r.push(o);if(t.display){for(;null!==(n=s.exec(e));)a=c(n[1],1),/^\w+:\/\/\/?\w/i.test(a)||r.push(a);for(;null!==(n=l.exec(e));)a=c(n[1],1),/^\w+:\/\/\/?\w/i.test(a)||r.push(a)}}return r}return{hasTag:e,parse:o}}(),e.settings=function(){function e(e){if(0==t.omitTags.length)return!1;for(var n=0;n<t.omitTags.length;n++)if(t.omitTags[n]==e)return!0;return!1}function n(){var e;if((e=window.document.getElementById("storeArea")?window.document.getElementById("storeArea").querySelector('div[tiddler="StorySettings"]'):window.document.querySelector('tw-passagedata[name="StorySettings"]'))&&e.innerText&&!(!e.innerText.split("dotgraph:").length>0)){var n=e.innerText.split("dotgraph:")[1].split("\n")[0];try{n=JSON.parse(n)}catch(e){return void console.log("Found but couldn't parse dotscap settings: "+n)}_.each(n,function(e,n){t[n]=e})}}function o(){t.checkpoints=!!document.getElementById("checkpointsCheckbox")&&document.getElementById("checkpointsCheckbox").checked,t.cluster=!!document.getElementById("clusterCheckbox")&&document.getElementById("clusterCheckbox").checked,t.color=document.querySelector("input[name='colorCheckbox']:checked")?document.querySelector("input[name='colorCheckbox']:checked").value:"length",t.display=!document.getElementById("displayCheckbox")||document.getElementById("displayCheckbox").checked,t.ends=!!document.getElementById("endsCheckbox")&&document.getElementById("endsCheckbox").checked,t.omitSpecialPassages=!!document.getElementById("specialCheckbox")&&document.getElementById("specialCheckbox").checked,t.showNodeNames=!!document.getElementById("nodeCheckbox0")&&document.getElementById("nodeCheckbox0").checked,t.omitTags=document.getElementById("omitTags")?r(document.getElementById("omitTags").value):[],t.lastTag=!!document.getElementById("lastTagCheckbox")&&document.getElementById("lastTagCheckbox").checked,t.countWords=!!document.getElementById("wcCheckbox")&&document.getElementById("wcCheckbox").checked,t.trace=document.getElementById("trace")?c(document.getElementById("trace").value):""}function a(){var e=_.template('<input type="radio" id="nodeCheckbox0" name="nodeCheckbox" value="names" <%= (showNodeNames ? "checked" : "") %>/><label for="nodeCheckbox">&nbsp;Passage titles</label> \t\t\t<input type="radio" id="nodeCheckbox1" name="nodeCheckbox" value="pid"  <%= (showNodeNames ? "" : "checked") %> /><label for="nodeCheckbox">&nbsp;Passage ids</label><br/> \t\t\t<input type="radio" id="colorCheckbox0" name="colorCheckbox" value="bw" <%= (color == "bw" ? "checked" : "")%> />&nbsp;<label for="colorCheckbox0">Black & white</label> \t\t\t<input type="radio" id="colorCheckbox1" name="colorCheckbox" value="length" <%= (color == "length" ? "checked" : "")%> />&nbsp;<label for="colorCheckbox1">Color by node length</label> \t\t\t<input type="radio" id="colorCheckbox2" name="colorCheckbox" value="tag" <%= (color == "tag" ? "checked" : "")%>/>&nbsp;<label for="colorCheckbox2">Color by tag</label><br/> \t\t\t<input type="checkbox" id="displayCheckbox" name="displayCheckbox" checked/>&nbsp;<label for="displayCheckbox">Include display macro links</label> \t\t\t\x3c!-- <input type="checkbox" id="wcCheckbox" name="wcCheckbox" <%= (countWords ? "checked" : "") %> />&nbsp;<label for="wcCheckbox">Include word counts</label> --\x3e<br/> \t\t\t<input type="checkbox" id="specialCheckbox" <%= (omitSpecialPassages ? "checked" : "") %> />&nbsp;<label for="specialCheckbox">Omit&nbsp;special&nbsp;passages</label> (StoryAuthor,&nbsp;StorySubtitle,&nbsp;etc.)<br/> \t\t\t<input type="radio" id="omitTagsFakeRadioButton" disabled/>&nbsp;<label for="omitTags">Omit by tag(s):</label>&nbsp;<input type="input" id="omitTags" placeholder="Separate tags with commas." value="<%=omitTags.join(" ")%>"/><br/> \t\t\t<input type="checkbox" id="checkpointsCheckbox" <%= (checkpoint ? "checked" : "") %> />&nbsp;<label for="checkpointsCheckbox">Detect checkpoint tags</label> \t\t\t<input type="checkbox" id="endsCheckbox" <%= (ends == true ? "checked" : "") %>/>&nbsp;<label for="endsCheckbox">Detect end tags</label> \t\t\t<input type="checkbox" id="lastTagCheckbox" <%= (lastTag ? "checked" : "") %> />&nbsp;<label for="lastTagCheckbox">Use last tag</label><br/> \t\t\t\x3c!-- <input type="checkbox" id="clusterCheckbox" <%= (cluster ? "checked" : "") %> />&nbsp;<label for="clusterCheckbox">Cluster by tags</label> --\x3e \t\t\t<input type="radio" id="traceFakeRadioButton" disabled/>&nbsp;<label for="trace">Trace phrase:</label>&nbsp;<input type="input" id="trace" value="<%=trace%>" /><br/> \t\t\t<br/>');document.getElementById("settingsForm").innerHTML=e(t)}function r(e){for(var t=e.trim().split(","),n=[],o=0;o<t.length;o++){var a=t[o].trim();""!=a&&n.push(a)}return document.getElementById("omitTagsFakeRadioButton").checked=n.length>0,n}function c(e){return e=e.trim(),document.getElementById("traceFakeRadioButton").checked=e.length>0,e}return{isOmittedTag:e,load:n,parse:o,write:a}}(),e.story=function(){function a(){var a,i,s=window.document.getElementById("storeArea"),l=window.document.getElementsByTagName("tw-storydata")[0];if(s){o.twineVersion=1;var d="Untitled Story";s.querySelectorAll('[tiddler="StoryTitle"]').length&&(d=s.querySelectorAll('[tiddler="StoryTitle"]')[0].innerText),o.title=d}else l?(o.twineVersion=2,o.title=l.getAttribute("name")?l.getAttribute("name"):"Untitled",o.startNode=l.getAttribute("startnode")?l.getAttribute("startnode"):1):(o.title=1,o.startNode=1);for(i=s?s.querySelectorAll("div[tiddler]"):document.querySelectorAll("tw-passagedata"),o.passages=r(i),o.leaves=0,o.links=0,o.tightEnds=0,o.tagObject={},o.tags=[],o.targets={},o.reachable=o.reachable.concat(n),a=0;a<o.passages.length;a++){var u=o.passages[a];s&&"Start"==u.name&&(o.startNode=a),t.ends&&e.passage.hasTag(u,t.endTag)&&o.tightEnds++,u.pid==o.startNode&&(o.startNodeName=u.name,o.reachable.push(u.name)),u.theTag&&(o.tagObject.hasOwnProperty(u.theTag)||(o.tagObject[u.theTag]=[],o.tags.push(u.theTag)),o.tagObject[u.theTag].push(u.name)),o.targets[u.name]=u.pid,o.links+=u.links.length,o.reachable=o.reachable.concat(_.map(u.links,_.first)),!u.leaf||u.omit||u.special&&t.omitSpecialPassages||o.leaves++}o.reachable=_.uniq(o.reachable),o.unreachable=_.difference(_.pluck(o.passages,"name"),o.reachable),o.maxLength=o.passages.reduce(function(e,t){return Math.max(e,t.textLength)},1),o.avLength=o.passages.reduce(function(e,t){return e+t.textLength},0)/o.passages.length,console.log(o.avLength),c()}function r(t){for(var n=[],o=0;o<t.length;o++)n[o]=e.passage.parse(t[o],o);return n}function c(){if(document.getElementById("nodeCount").innerHTML=o.passages.length,t.omitSpecialPassages||t.omitTags.length>0){var e=o.passages.reduce(function(e,n){return e+(n.special&&t.omitSpecialPassages||n.omit?1:0)},0);document.getElementById("omitCount").innerHTML=" ("+(o.passages.length-e)+" included, "+e+" omitted, "+o.unreachable.length+" unreachable)"}if(document.getElementById("leafCount").innerHTML=o.leaves,t.ends){var n=o.leaves-o.tightEnds;document.getElementById("looseCount").innerHTML=" (including "+(n>0?n:0)+" loose end"+(1!=n?"s":"")+")"}else document.getElementById("looseCount").innerHTML="";document.getElementById("linkCount").innerHTML=o.links,document.getElementById("average").innerHTML=Math.round(o.links/o.passages.length*100)/100,document.getElementById("stats").setAttribute("title","Twine "+o.twineVersion)}return{parse:a}}()}(dotScap),window.onload=dotScap.init.load();
},{"filesaver.js-npm":1,"underscore":2,"uuid/v3":6}]},{},[7]);
</script>
</body>
</html>
