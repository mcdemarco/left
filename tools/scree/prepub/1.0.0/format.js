window.storyFormat({"description":"A Markdown story format for use with Pandoc.","author":"M. C. DeMarco","image":"icon.svg","name":"PrePub","url":"https://bitbucket.org/mcdemarco/prepub","version":"1.0.0","proofing":true,"source":"<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title>\n\t\t\t{{STORY_NAME}}\n\t\t</title>\n\t\t<meta charset=\"utf-8\">\n\t\t<script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js\"></script>\n\t\t<script>\n/**\n * PrePub - Twine 2 Markdown Export Story Format\n * Based on Enscree\n * \n * Copyright (c) 2017 M. C. DeMarco\n * https://www.mcdemarco.net/tools/scree/prepub/\n *\n * This license applies exclusively to the PrePub story format for Twine 2. No ownership of, nor\n * licensing restrictions on, the content within the generated story are stated or implied.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and\n * associated documentation files (the \"Software\"), to deal in the Software without restriction,\n * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or substantial\n * portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\n * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\t\t</script>\n<script>(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nwindow.onload=function(){void 0===window.PrePub&&(window.PrePub={convert:function(){var t=this.export(),e=new Blob([t],{type:\"text/markdown;charset=utf-8\"});saveAs(e,\"prepub\"+Date.now()+\".md\")},export:function(){var t,e,r,n,a,s,i=[];document.getElementsByTagName(\"tw-storydata\").length>0?(t=document.querySelector(\"tw-storydata\"),e=2,r=\"tw-passagedata[name=StoryAuthor]\",'*[type=\"text/twine-css\"]','*[type=\"text/twine-javascript\"]',n=\"tw-passagedata[name=StorySubtitle]\",a=\"tw-passagedata\",s=\"name\"):(t=document.querySelector(\"#storeArea\"),e=1,r=\"div[tiddler=StoryAuthor]\",'*[tags*=\"stylesheet\"]','*[tags*=\"script\"]',n=\"div[tiddler=StorySubtitle]\",a=\"*[tiddler]\",s=\"tiddler\");var o=2==e?t.getAttribute(\"name\"):t.querySelector(\"div[tiddler=StoryTitle]\")?t.querySelector(\"div[tiddler=StoryTitle]\").textContent:\"Untitled Story\",u=t.querySelector(n)?t.querySelector(n).innerHTML:\"\",d=t.querySelector(r)?t.querySelector(r).textContent:\"\",l=2==e?t.querySelector('tw-passagedata[pid=\"'+t.getAttribute(\"startnode\")+'\"]').getAttribute(s):\"Start\";if(t){var c=(u?\"*\"+u+\"* \\n\\n\":\"\")+(d?\"by \"+d+\"\\n\\n\":\"\")+\"[\"+l+\"]\";i.push(this.buildPassage(o,c))}for(var y=document.querySelectorAll(a),b=0;b<y.length;++b){var g=y[b].getAttribute(s);g||(g=\"Untitled Passage\");var p=y[b].textContent;i.push(this.buildPassage(g,p))}return i.join(\"\")},buildPassage:function(t,e){var r=[];return r.push(\"## \",t),r.push(\"\\r\\n\",this.scrub(e),\"\\r\\n\\r\\n\"),r.join(\"\")},markdownLinks:function(t){return t.replace(/\\[\\[(.*?)\\]\\]/g,function(t,e){var r,n=e.indexOf(\"|\");if(-1!=n)r=e.substr(0,n),e=e.substr(n+1);else{var a=e.indexOf(\"->\");if(-1!=a)r=e.substr(0,a),e=e.substr(a+2);else{var s=e.indexOf(\"<-\");-1!=s&&(r=e.substr(s+2),e=e.substr(0,s))}}return r?\"[\"+r+\"][\"+e+\"]\":\"[\"+e+\"]\"})},scrub:function(t){return t&&(t=t.replace(/^##/gm,\" ##\"),t=t.replace(/\\\\</gm,\"&lt;\"),t=t.replace(/\\\\>/gm,\"&gt;\"),t=this.markdownLinks(t)),t}}),window.PrePub.convert()};\n},{}]},{},[1]);\n</script>\n\t</head>\n\t<body>\n\t\t<pre id=\"output\">\n\t\t\n\t\t</pre>\n\t\t<div id=\"storyData\" style=\"display: none;\">\n{{STORY_DATA}}\n\t\t</div>\n\t</body>\n</html>\n"});