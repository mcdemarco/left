window.storyFormat({"description":"A proofing format for creating Graphviz graphs.","author":"M. C. DeMarco","image":"icon.svg","name":"DotGraph","url":"https://bitbucket.org/mcdemarco/dotgraph","version":"2.0.0","proofing":true,"source":"<!DOCTYPE html>\n<html>\n<head>\n<title>\n{{STORY_NAME}}\n</title>\n<meta charset=\"utf-8\">\n<style>\n body {margin:3%;}\n tw-storydata {display:none;}\n span#stats {font-style:italic;}\n label {white-space:nowrap;}\n</style>\n<script src=\"https://mcdemarco.net/tools/scree/dotgraph/viz.js\" type=\"text/javascript\"></script>\n</head>\n<body>\n\t<h1>DotGraph Proofing Format</h1>\n\t<div>\n\t\tIf rendering of the graph fails (i.e., you only see the dot source file) or you need the output in a different format, the dot source can also be rendered using the free desktop program <a href=\"http://www.graphviz.org/\">Graphviz</a>, or rendered online at <a href=\"http://stamm-wilbrandt.de/GraphvizFiddle/\">GraphvizFiddle</a> or <a href=\"http://www.webgraphviz.com\">WebGraphviz</a>.\n\t</div>\n\t<h2>Graph</h2>\n\t<div style=\"font-size:smaller;width:45%; float:right;\">\n\t\tNotes:  When color is on, nodes that are linked but do not exist are colored white.  When color by length is on, all other nodes are colored in shades of red (shorter than average) to blue (longer than average) based on the relative length of their contents.<br/>  The start node is double-circled.  The cluster and color by tag options use the first tag on each passage.  Optional detection of an \"End\" tag changes the shape of \"End\" passages to an egg (and puts diagonals on loose ends and disconnected nodes).  Optional detection of a \"checkpoint\" tag changes the shape of checkpoint passages to a diamond.<br/>  Stray or misplaced nodes tend to indicate duplicate passage names or other linking issues.  The image format is SVG.\n\t</div>\n\t<div>\n\t\t<span id=\"stats\">\n\t\t\t<span id=\"nodeCount\">0</span>&nbsp;nodes, \n\t\t\t<span id=\"leafCount\">0</span>&nbsp;leaves<span id=\"looseCount\"></span>,\n\t\t\t<span id=\"linkCount\">0</span>&nbsp;links, and\n\t\t\t<span id=\"average\">0</span>&nbsp;links&nbsp;per&nbsp;node.\n\t\t</span><br/>\n\t\t<form id=\"settingsForm\">\n\t\t\t<input type=\"radio\" id=\"nodeCheckbox0\" name=\"nodeCheckbox\" value=\"names\"/>&nbsp;<label for=\"nodeCheckbox\">Passage titles</label>\n\t\t\t<input type=\"radio\" id=\"nodeCheckbox1\" name=\"nodeCheckbox\" value=\"pid\" checked/>&nbsp;<label for=\"nodeCheckbox\">Passage ids (hover for title)</label>\n\t\t\t<input type=\"checkbox\" id=\"renumberCheckbox\" name=\"renumberCheckbox\"/>&nbsp;<label for=\"renumberCheckbox\">renumber from 1</label><br />\n\t\t\t<input type=\"radio\" id=\"colorCheckbox0\" name=\"colorCheckbox\" value=\"none\"/>&nbsp;<label for=\"colorCheckbox0\">Black & white</label>\n\t\t\t<input type=\"radio\" id=\"colorCheckbox1\" name=\"colorCheckbox\" value=\"node\" checked/>&nbsp;<label for=\"colorCheckbox1\">Color by node length</label>\n\t\t\t<input type=\"radio\" id=\"colorCheckbox2\" name=\"colorCheckbox\" value=\"tag\"/>&nbsp;<label for=\"colorCheckbox2\">Color by tag</label><br/>\n\n\t\t\t<input type=\"checkbox\" id=\"specialCheckbox\" checked/>&nbsp;<label for=\"specialCheckbox\">Omit special passages (StoryAuthor, StorySubtitle, etc.)</label><br/>\n\t\t\t<input type=\"checkbox\" id=\"checkpointsCheckbox\" checked/>&nbsp;<label for=\"checkpointsCheckbox\">Detect checkpoint tags</label>\n\t\t\t<input type=\"checkbox\" id=\"endsCheckbox\" checked/>&nbsp;<label for=\"endsCheckbox\">Detect end tags</label><br/>\n\t\t\t<input type=\"checkbox\" id=\"clusterCheckbox\"/>&nbsp;<label for=\"clusterCheckbox\">Cluster by tags</label><br/>\n\t\t\t<input type=\"radio\" id=\"rotateCheckbox0\" name=\"rotateCheckbox\" value=\"TB\" checked/>&nbsp;<label for=\"rotateCheckbox0\" title=\"Top to bottom\">&darr;</label>\n\t\t\t<input type=\"radio\" id=\"rotateCheckbox1\" name=\"rotateCheckbox\" value=\"LR\"/>&nbsp;<label for=\"rotateCheckbox1\" title=\"Left to right\">&rarr;</label>\n\t\t\t<input type=\"radio\" id=\"rotateCheckbox2\" name=\"rotateCheckbox\" value=\"BT\"/>&nbsp;<label for=\"rotateCheckbox2\" title=\"Bottom to top\">&uarr;</label>\n\t\t\t<input type=\"radio\" id=\"rotateCheckbox3\" name=\"rotateCheckbox\" value=\"RL\"/>&nbsp;<label for=\"rotateCheckbox3\" title=\"Right to left\">&larr;</label>\n\t\t\t<input type=\"checkbox\" id=\"scaleCheckbox\" checked/>&nbsp;<label for=\"scaleCheckbox\">Scale to fit page</label><br/>\n\t\t</form>\n\t\t<button type=\"button\" id=\"saveSvgButton\">Save Image</button><br/>\n\t</div>\n\t<div id=\"graph\" style=\"clear:both;\"></div>\n\t<h2>Dot Source</h2>\n\t<button type=\"button\" id=\"editButton\">Redraw with edits</button>\n\t<button type=\"button\" id=\"saveDotButton\">Save Source</button><br/>\n\t\n\t<textarea id=\"dotfile\" style=\"width:100%;\"></textarea>\n\t\n{{STORY_DATA}}\n\n<script>(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar saveAs=saveAs||function(e){\"use strict\";if(\"undefined\"==typeof navigator||!/MSIE [1-9]\\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS(\"http://www.w3.org/1999/xhtml\",\"a\"),r=\"download\"in o,i=function(e){var t=new MouseEvent(\"click\");e.dispatchEvent(t)},a=/Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent),c=e.webkitRequestFileSystem,d=e.requestFileSystem||c||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u=\"application/octet-stream\",s=0,l=4e4,v=function(e){var t=function(){\"string\"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,l)},p=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e[\"on\"+t[o]];if(\"function\"==typeof r)try{r.call(e,n||e)}catch(e){f(e)}}},w=function(e){return/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(e.type)?new Blob([\"ï»¿\",e],{type:e.type}):e},y=function(t,f,l){l||(t=w(t));var y,m,S,h=this,R=t.type,O=!1,g=function(){p(h,\"writestart progress write writeend\".split(\" \"))},b=function(){if(m&&a&&\"undefined\"!=typeof FileReader){var o=new FileReader;return o.onloadend=function(){var e=o.result;m.location.href=\"data:attachment/file\"+e.slice(e.search(/[,;]/)),h.readyState=h.DONE,g()},o.readAsDataURL(t),void(h.readyState=h.INIT)}if(!O&&y||(y=n().createObjectURL(t)),m)m.location.href=y;else{var r=e.open(y,\"_blank\");void 0===r&&a&&(e.location.href=y)}h.readyState=h.DONE,g(),v(y)},E=function(e){return function(){if(h.readyState!==h.DONE)return e.apply(this,arguments)}},N={create:!0,exclusive:!1};return h.readyState=h.INIT,f||(f=\"download\"),r?(y=n().createObjectURL(t),void setTimeout(function(){o.href=y,o.download=f,i(o),g(),v(y),h.readyState=h.DONE})):(e.chrome&&R&&R!==u&&(S=t.slice||t.webkitSlice,t=S.call(t,0,t.size,u),O=!0),c&&\"download\"!==f&&(f+=\".download\"),(R===u||c)&&(m=e),d?(s+=t.size,void d(e.TEMPORARY,s,E(function(e){e.root.getDirectory(\"saved\",N,E(function(e){var n=function(){e.getFile(f,N,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){m.location.href=e.toURL(),h.readyState=h.DONE,p(h,\"writeend\",t),v(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&b()},\"writestart progress write abort\".split(\" \").forEach(function(e){n[\"on\"+e]=h[\"on\"+e]}),n.write(t),h.abort=function(){n.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),b)}),b)};e.getFile(f,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():b()}))}),b)}),b)):void b())},m=y.prototype,S=function(e,t,n){return new y(e,t,n)};return\"undefined\"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=w(e)),navigator.msSaveOrOpenBlob(e,t||\"download\")}:(m.abort=function(){var e=this;e.readyState=e.DONE,p(e,\"abort\")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,S)}}(\"undefined\"!=typeof self&&self||\"undefined\"!=typeof window&&window||this.content);\"undefined\"!=typeof module&&module.exports?module.exports.saveAs=saveAs:\"undefined\"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});\n\n},{}],2:[function(require,module,exports){\nvar filesaver=require(\"filesaver.js-npm\"),dotGraph={};!function(e){var t={checkpoint:!0,checkpointTag:\"checkpoint\",cluster:!1,colorBW:!0,colorByNode:!0,colorByTag:!1,ends:!0,endTag:\"End\",omitSpecialPassages:!0,renumber:!1,rotation:\"TB\",scale:!0,showNodeNames:!1,palette:[\"#FEAF16\",\"#2ED9FF\",\"#DEA0FD\",\"#FE00FA\",\"#F7E1A0\",\"#16FF32\",\"#3283FE\",\"#1C8356\",\"#FBE426\",\"#FA0087\",\"#F8A19F\",\"#1CBE4F\",\"#C4451C\",\"#C075A6\",\"#90AD1C\",\"#B00068\",\"#AA0DFE\",\"#FC1CBF\",\"#1CFFCE\",\"#F6222E\",\"#85660D\",\"#325A9B\",\"#B10DA1\",\"#A0A0A0\",\"#782AB6\",\"#565656\"]},n=[\"StoryTitle\",\"StoryIncludes\",\"StoryAuthor\",\"StorySubtitle\",\"StoryMenu\",\"StorySettings\",\"StoryColophon\",\"StoryBanner\",\"StoryCaption\",\"StoryInit\",\"StoryShare\",\"PassageDone\",\"PassageFooter\",\"PassageHeader\",\"PassageReady\",\"MenuOptions\",\"MenuShare\"],s={title:\"Untitled\",startNode:1,startNodeName:\"Start\",leaves:0,links:0,tightEnds:0,avLength:1,maxLength:1,passages:[],tags:[],tagObject:[],targets:{}};e.graph=function(){function n(){var t=c(),n=document.getElementById(\"dotfile\");n.value=t,n.style.height=n.scrollHeight+\"px\",document.getElementById(\"graph\").innerHTML=Viz(t,\"svg\"),e.settings.scale()}function a(){var t=document.getElementById(\"dotfile\").value;document.getElementById(\"graph\").innerHTML=Viz(t,\"svg\"),e.settings.scale()}function o(){var e=document.getElementById(\"dotfile\").value,t=new Blob([e],{type:\"text/plain;charset=utf-8\"});filesaver.saveAs(t,\"dot\"+Date.now()+\".txt\",!0)}function r(){var e=document.getElementById(\"dotfile\").value,t=Viz(e,\"svg\").replace(\"no\",\"yes\"),n=new Blob([t],{type:\"image/svg+xml;charset=utf-8\"});filesaver.saveAs(n,\"dotgraph\"+Date.now()+\".svg\",!0)}function c(){var n=[];return e.settings.parse(),e.story.parse(),n.push(\"digraph \"+m(s.title)+\" {\"),n.push(\"rankdir=\"+t.rotation+\"\\r\\n\"),t.cluster?n=n.concat(f(s.tagObject)):t.colorByTag&&(n=n.concat(y(s,t))),n=n.concat(u()),n.push('\\nlabelloc=\"t\"\\n'),n.push(\"label=\"+m(s.title)),n.push(\"\\n}\"),n.join(\"\\r\\n\")}function l(e){return s.targets.hasOwnProperty(e)?s.targets[e]:m(e)}function i(e,n){for(var s=[],a=0;a<e.links.length;a++){var o=e.links[a];s.push(n+\" -> \"+(t.showNodeNames?m(o):l(o)))}return s}function d(e,n){var s,a=n?!t.showNodeNames:t.showNodeNames;return s=a?m(e.name):e.pid?e.pid:m(\"Untitled Passage\")}function g(e){var n;return n=t.showNodeNames?m(e):l(e)}function u(){var e=[];if(t.renumber&&!t.showNodeNames){var n;for(n=0;n<s.passages.length;++n)s.passages[n].pid==s.startNode&&(e=e.concat(h(s.passages[n],1)));var a=2;for(n=0;n<s.passages.length;++n){var o=s.passages[n];o.pid==s.startNode||t.omitSpecialPassages&&o.special||(e=e.concat(h(o,a)),a++)}}else for(n=0;n<s.passages.length;++n)e=e.concat(h(s.passages[n]));return e}function h(e,n){var s=[];if(t.omitSpecialPassages&&e.special)return s;var a=d(e),o=p(e,n),r=i(e,a);return s.push(\"\\r\\n\"+a+\" [\"+o.join(\" \")+\"]\"),s=s.concat(r)}function p(n,a){var o=[],r=0,c=n.pid,l=(n.content,n.firstTag);if(c==s.startNode?o.push(\"shape=doublecircle\"):t.ends&&e.passage.hasTag(n,t.endTag)?o.push(\"shape=egg\"):t.checkpoints&&e.passage.hasTag(n,t.checkpointTag)&&o.push(\"shape=diamond\"),0===o.length&&0===n.links.length&&t.ends?o.push('style=\"filled,diagonals\"'):o.length?o.push('style=\"filled,bold\"'):t.colorBW||o.push(\"style=filled\"),t.colorByNode)r=Math.round(100*Math.min(1.75,n.textLength/s.avLength)/3)/100,o.push('fillcolor=\"'+r+',0.66,0.85\"');else if(t.colorByTag&&l){var i=s.tags.indexOf(l);i>-1&&(r=t.palette[i%26]),o.push('fillcolor=\"'+r+'\"')}return a&&o.push('label=\"'+a+'\"'),o.push(\"tooltip=\"+d(n,!0)),o}function m(e){return e&&(e=e.replace(/\"/gm,'\\\\\"').replace(/[^\\x00-\\x7F]/g,\"\"),e='\"'+e+'\"'),e}function f(e){var t=[],n=0;for(var s in e)e.hasOwnProperty(s)&&(t.push(\"subgraph cluster_\"+n+\" {\"),t.push(\"label=\"+m(s)),t.push('style=\"rounded, filled\" fillcolor=\"ivory\"'),t.push(e[s].map(g).join(\" \\r\\n\")),t.push(\"}\\r\\n\"),n++);return t}function y(e,t){for(var n,a=['{rank=source\\r\\nstyle=\"rounded, filled\"'],o=0;o<e.tags.length;o++)n=m(s.tags[o]),a.push(n+' [shape=rect style=\"filled,rounded\" fillcolor=\"'+t.palette[o%26]+'\"]');a.push(\"}\");var r=t.showNodeNames?e.startNodeName:e.startNode;for(o=0;o<e.tags.length;o++)a.push(m(e.tags[o])+\" -> \"+r+\" [style=invis]\");return a}return{convert:n,edit:a,saveDot:o,saveSvg:r}}(),e.init=function(){function t(){n(),e.graph.convert()}function n(){document.getElementById(\"settingsForm\").addEventListener(\"click\",e.graph.convert,!1),document.getElementById(\"editButton\").addEventListener(\"click\",e.graph.edit,!1),document.getElementById(\"saveDotButton\").addEventListener(\"click\",e.graph.saveDot,!1),document.getElementById(\"saveSvgButton\").addEventListener(\"click\",e.graph.saveSvg,!1)}return{load:t}}(),e.passage=function(){function e(e,t){return e.tagArray.indexOf(t)>-1}function s(e,t){var s={},o=e.getAttribute(\"tags\")?e.getAttribute(\"tags\").split(\" \"):[];return s.content=e.innerText,s.links=r(e.innerText),s.textLength=e.innerText.length,s.pid=e.getAttribute(\"pid\")?e.getAttribute(\"pid\"):t,s.tagArray=o,s.firstTag=a(o),s.name=e.getAttribute(\"name\")?e.getAttribute(\"name\"):e.getAttribute(\"tiddler\")?e.getAttribute(\"tiddler\"):\"Untitled Passage\",s.special=n.indexOf(s.name)>-1,s}function a(e){var n=e.slice(0);return t.ends&&n.indexOf(t.endTag)>-1&&n.splice(n.indexOf(t.endTag),1),t.checkpoints&&n.indexOf(t.checkpointTag)>-1&&n.splice(n.indexOf(t.checkpointTag),1),n.length?n[0]:\"\"}function o(e){var t=e.indexOf(\"|\");if(t!=-1)e=e.substr(t+1);else{var n=e.indexOf(\"->\");if(n!=-1)e=e.substr(n+2);else{var s=e.indexOf(\"<-\");s!=-1&&(e=e.substr(0,s))}}return e}function r(e){var t,n=[],s=/\\[\\[(.*?)\\]\\]/g;if(e)for(e=e.replace(/\\/\\*.*\\*\\//g,\"\"),e=e.replace(/^\\/\\/.*(\\r\\n?|\\n)/g,\"\");null!==(t=s.exec(e));){var a=o(t[1]);/^\\w+:\\/\\/\\/?\\w/i.test(a)||n.push(a)}return n}return{hasTag:e,parse:s}}(),e.settings=function(){function e(){t.checkpoints=!!document.getElementById(\"checkpointsCheckbox\")&&document.getElementById(\"checkpointsCheckbox\").checked,t.cluster=!!document.getElementById(\"clusterCheckbox\")&&document.getElementById(\"clusterCheckbox\").checked,t.colorBW=!!document.getElementById(\"colorCheckbox0\")&&document.getElementById(\"colorCheckbox0\").checked,t.colorByNode=!!document.getElementById(\"colorCheckbox1\")&&document.getElementById(\"colorCheckbox1\").checked,t.colorByTag=!!document.getElementById(\"colorCheckbox2\")&&document.getElementById(\"colorCheckbox2\").checked,t.ends=!!document.getElementById(\"endsCheckbox\")&&document.getElementById(\"endsCheckbox\").checked,t.omitSpecialPassages=!!document.getElementById(\"specialCheckbox\")&&document.getElementById(\"specialCheckbox\").checked,t.renumber=!!document.getElementById(\"renumberCheckbox\")&&document.getElementById(\"renumberCheckbox\").checked,t.rotation=document.querySelector(\"input[name='rotateCheckbox']:checked\")?document.querySelector(\"input[name='rotateCheckbox']:checked\").value:\"TB\",t.scale=!document.getElementById(\"scaleCheckbox\")||document.getElementById(\"scaleCheckbox\").checked,t.showNodeNames=!!document.getElementById(\"nodeCheckbox0\")&&document.getElementById(\"nodeCheckbox0\").checked}function n(){if(t.scale){var e=document.getElementsByTagName(\"svg\")[0];e.setAttribute(\"width\",\"100%\"),e.removeAttribute(\"height\")}}return{parse:e,scale:n}}(),e.story=function(){function n(){var n,r,c=window.document.getElementById(\"storeArea\"),l=window.document.getElementsByTagName(\"tw-storydata\")[0];if(c){var i=\"Untitled Story\";c.querySelectorAll('[tiddler=\"StoryTitle\"]').length&&(i=c.querySelectorAll('[tiddler=\"StoryTitle\"]')[0].innerText),s.title=i}else l?(s.title=l.getAttribute(\"name\")?l.getAttribute(\"name\"):\"Untitled\",s.startNode=l.getAttribute(\"startnode\")?l.getAttribute(\"startnode\"):1):(s.title=1,s.startNode=1);for(r=c?c.querySelectorAll(\"div[tiddler]\"):document.querySelectorAll(\"tw-passagedata\"),s.passages=a(r),s.leaves=0,s.links=0,s.tightEnds=0,s.tagObject={},s.tags=[],s.targets={},n=0;n<s.passages.length;n++)c&&\"Start\"==s.passages[n].name&&(s.startNode=n),t.ends&&e.passage.hasTag(s.passages[n],t.endTag)&&s.tightEnds++,s.passages[n].pid==s.startNode&&(s.startNodeName=s.passages[n].scrubbedNameOrPid),s.passages[n].firstTag&&(s.tagObject.hasOwnProperty(s.passages[n].firstTag)||(s.tagObject[s.passages[n].firstTag]=[],s.tags.push(s.passages[n].firstTag)),s.tagObject[s.passages[n].firstTag].push(s.passages[n].name)),s.targets[s.passages[n].name]=s.passages[n].pid,s.links+=s.passages[n].links.length,0===s.passages[n].links.length&&s.leaves++;s.maxLength=s.passages.reduce(function(e,t){return Math.max(e,t.textLength)},1),s.avLength=s.passages.reduce(function(e,t){return e+t.textLength},0)/s.passages.length,o()}function a(t){for(var n=[],s=0;s<t.length;s++)n[s]=e.passage.parse(t[s],s);return n}function o(){if(document.getElementById(\"nodeCount\").innerHTML=s.passages.length,document.getElementById(\"leafCount\").innerHTML=s.leaves,document.getElementById(\"linkCount\").innerHTML=s.links,t.ends){var e=s.leaves-s.tightEnds;document.getElementById(\"looseCount\").innerHTML=\" (including \"+e+\" loose end\"+(1!=e?\"s\":\"\")+\")\"}else document.getElementById(\"looseCount\").innerHTML=\"\";document.getElementById(\"average\").innerHTML=Math.round(100*(s.links/s.passages.length))/100}return{parse:n}}()}(dotGraph),window.onload=dotGraph.init.load();\n},{\"filesaver.js-npm\":1}]},{},[2]);\n</script>\n</body>\n</html>\n"});