<!DOCTYPE html>
<html>
<head>
<title>
DotGraph
</title>
<meta charset="utf-8">
<style>
 body {margin:3%;}
 tw-storydata {display:none;}
 span#stats {font-style:italic;}
</style>
<script src="https://mcdemarco.net/tools/scree/dotgraph/viz.js" type="text/javascript"></script>
</head>
<body>
	<h1>DotGraph Proofing Format</h1>
	<div>
		If rendering of the graph fails (i.e., you only see the dot source file), you want a different format, or you want to edit your graph, the dot source can also be rendered using the free desktop program <a href="http://www.graphviz.org/">Graphviz</a>, or rendered online at <a href="http://stamm-wilbrandt.de/GraphvizFiddle/">GraphvizFiddle</a> or <a href="http://www.webgraphviz.com">WebGraphviz</a>.
	</div>
	<h2>Graph</h2>
	<div style="font-size:smaller;width:50%; float:right;">
		Notes:  The start node is double-circled.  When color by length is on, nodes that are linked but do not exist are colored white and all other nodes are colored in shades of red (short) to green (long) based on the relative length of their contents.  The cluster and color by tag options use the first tag on each passage.  Optional detection of an "End" tag adds diagonals to "End" passages.  Optional detection of a "checkpoint" tag changes the shape of checkpoint passages to a diamond.  The image format is SVG.
	</div>
	<div>
		<span id="stats">
			<span id="nodeCount">0</span>&nbsp;nodes, 
			<span id="leafCount">0</span>&nbsp;leaves<span id="looseCount"></span>,
			<span id="linkCount">0</span>&nbsp;links, and
			<span id="average">0</span>&nbsp;links&nbsp;per&nbsp;node.
		</span><br/>
		<input type="checkbox" id="nodeCheckbox" checked/>&nbsp;<label for="nodeCheckbox">Show node names</label><br />
		<input type="checkbox" id="clusterCheckbox"/>&nbsp;<label for="clusterCheckbox">Cluster by tags</label><br/>
		<input type="radio" id="colorCheckbox0" name="colorCheckbox" value="none"/>&nbsp;<label for="colorCheckbox0">Black & white</label>
		<input type="radio" id="colorCheckbox1" name="colorCheckbox" value="node" checked/>&nbsp;<label for="colorCheckbox1">Color by node length</label>
		<input type="radio" id="colorCheckbox2" name="colorCheckbox" value="tag"/>&nbsp;<label for="colorCheckbox2">Color by tag</label><br/>
		<input type="checkbox" id="checkpointsCheckbox" checked/>&nbsp;<label for="checkpointsCheckbox">Detect checkpoint tags</label>
		<input type="checkbox" id="endsCheckbox" checked/>&nbsp;<label for="endsCheckbox">Detect end tags</label><br/>
		<button type="button" id="rerunButton" onclick="window.DotGraph.convert();">Redraw</button>
		<button type="button" id="rerunButton" onclick="window.DotGraph.rotate();">Rotate</button>
		<button type="button" id="rerunButton" onclick="window.DotGraph.scale();">Scale to fit</button>
		<button type="button" id="saveSvgButton" onclick="window.DotGraph.save('svg');">Save</button><br/>
	</div>
	<div id="graph" style="clear:both;"></div>
	<h2>Dot Source</h2>
	<button type="button" id="rerunButton" onclick="window.DotGraph.edit();">Redraw with edits</button>
	<button type="button" id="saveDotButton" onclick="window.DotGraph.save('txt');">Save</button><br/>
	
	<textarea id="dotfile" style="width:100%;"></textarea>
	
<div id="storeArea" data-size="STORY_SIZE" hidden>"STORY"</div>

<script>(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var saveAs=saveAs||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,i=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),c=e.webkitRequestFileSystem,d=e.requestFileSystem||c||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",s=0,l=4e4,v=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,l)},p=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){f(e)}}},w=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["ï»¿",e],{type:e.type}):e},y=function(t,f,l){l||(t=w(t));var y,m,S,h=this,R=t.type,O=!1,g=function(){p(h,"writestart progress write writeend".split(" "))},b=function(){if(m&&a&&"undefined"!=typeof FileReader){var o=new FileReader;return o.onloadend=function(){var e=o.result;m.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),h.readyState=h.DONE,g()},o.readAsDataURL(t),void(h.readyState=h.INIT)}if(!O&&y||(y=n().createObjectURL(t)),m)m.location.href=y;else{var r=e.open(y,"_blank");void 0===r&&a&&(e.location.href=y)}h.readyState=h.DONE,g(),v(y)},E=function(e){return function(){if(h.readyState!==h.DONE)return e.apply(this,arguments)}},N={create:!0,exclusive:!1};return h.readyState=h.INIT,f||(f="download"),r?(y=n().createObjectURL(t),void setTimeout(function(){o.href=y,o.download=f,i(o),g(),v(y),h.readyState=h.DONE})):(e.chrome&&R&&R!==u&&(S=t.slice||t.webkitSlice,t=S.call(t,0,t.size,u),O=!0),c&&"download"!==f&&(f+=".download"),(R===u||c)&&(m=e),d?(s+=t.size,void d(e.TEMPORARY,s,E(function(e){e.root.getDirectory("saved",N,E(function(e){var n=function(){e.getFile(f,N,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){m.location.href=e.toURL(),h.readyState=h.DONE,p(h,"writeend",t),v(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&b()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=h["on"+e]}),n.write(t),h.abort=function(){n.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),b)}),b)};e.getFile(f,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():b()}))}),b)}),b)):void b())},m=y.prototype,S=function(e,t,n){return new y(e,t,n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=w(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(m.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,S)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});

},{}],2:[function(require,module,exports){
var filesaver=require("filesaver.js-npm");window.onload=function(){"undefined"==typeof window.DotGraph&&(window.DotGraph={settings:{checkpoint:!0,checkpointTag:"checkpoint",cluster:!1,colorBW:!0,colorByNode:!0,colorByTag:!1,ends:!0,endTag:"End",rotation:0,showNodeNames:!0,palette:["#FEAF16","#2ED9FF","#DEA0FD","#FE00FA","#F7E1A0","#16FF32","#3283FE","#1C8356","#FBE426","#FC1CBF","#C4451C","#1CBE4F","#C075A6","#90AD1C","#B00068","#AA0DFE","#FA0087","#F8A19F","#1CFFCE","#F6222E","#85660D","#325A9B","#B10DA1","#a0a0a0","#782AB6","#565656"]},story:{title:"Untitled",startNode:1,startNodeName:"Start",leaves:0,links:0,tightEnds:0,maxLength:1,passages:[],tags:[],tagObject:[],targets:{}},convert:function(){var t=this.export(),e=document.getElementById("dotfile");e.value=t,e.style.height=e.scrollHeight+"px",document.getElementById("graph").innerHTML=Viz(t,"svg")},edit:function(){var t=document.getElementById("dotfile").value;document.getElementById("graph").innerHTML=Viz(t,"svg")},export:function(){var t=[],e=["TB","LR","BT","RL"];this.parseSettings(),this.parseStory(),t.push("digraph "+this.story.title+" {\r\n"),t.push("rankdir="+e[this.settings.rotation]+"\r\n\r\n"),this.settings.cluster?t.push(this.writeClusterCode(this.story.tagObject)):this.settings.colorByTag&&t.push(this.writeTagKey(this.story,this.settings)),document.getElementById("nodeCount").innerHTML=this.story.passages.length;for(var s=0;s<this.story.passages.length;++s)t.push(this.parsePassageFromObject(this.story.passages[s]));if(t.push("}\r\n"),document.getElementById("nodeCount").innerHTML=this.story.passages.length,document.getElementById("leafCount").innerHTML=this.story.leaves,document.getElementById("linkCount").innerHTML=this.story.links,this.settings.ends){var r=this.story.leaves-this.story.tightEnds;document.getElementById("looseCount").innerHTML=" (including "+r+" loose end"+(r>1?"s":"")+")"}else document.getElementById("looseCount").innerHTML="";return document.getElementById("average").innerHTML=Math.round(100*(this.story.links/this.story.passages.length))/100,t.join("")},getFirstTag:function(t){var e=t.tagArray.slice(0);return this.settings.ends&&e.indexOf(this.settings.endTag)>-1&&e.splice(e.indexOf(this.settings.endTag),1),this.settings.checkpoints&&e.indexOf(this.settings.checkpointTag)>-1&&e.splice(e.indexOf(this.settings.checkpointTag),1),e.length?e[0]:""},getIdFromTarget:function(t){var e=this.scrub(t);return this.story.targets.hasOwnProperty(e)?this.story.targets[e]:e},hasTag:function(t,e){return t.tagArray.indexOf(e)>-1},parsePassageFromObject:function(t){var e=t.scrubbedTitleOrPid,s=t.pid,r=[];s==this.story.startNode?r.push("shape=doublecircle"):this.settings.ends&&this.hasTag(t,this.settings.endTag)?r.push("shape=egg"):this.settings.checkpoints&&this.hasTag(t,this.settings.checkpointTag)&&r.push("shape=diamond");var i=t.content,n=t.firstTag;return this.parsePassage(e,r,i,n)},parsePassage:function(t,e,s,r){var i=[],n=0,o=this.parseLinks(s,t);if(this.story.links+=o.length,0===o.length&&this.story.leaves++,0===e.length&&0===o.length?e.push('style="filled,diagonals"'):e.length?e.push('style="filled,bold"'):this.settings.colorBW||e.push("style=filled"),this.settings.colorByNode)n=Math.round(100*(s.length/this.story.maxLength)/3)/100,e.push('fillcolor="'+n+',0.66,0.85"');else if(this.settings.colorByTag&&r){var a=this.story.tags.indexOf(r);a>-1&&(n=this.settings.palette[a%26]),e.push('fillcolor="'+n+'"')}return i.push(t),e.length&&i.push(" ["+e.join(" ")+"]"),i.push("\r\n",o.join("\r\n"),"\r\n"),i.join("")},parsePassageName:function(t,e){var s;return s=this.settings.showNodeNames||e?this.scrub(t.name):t.pid?t.pid:this.scrub("Untitled Passage")},parseLink:function(t){var e=t.indexOf("|");if(e!=-1)t=t.substr(e+1);else{var s=t.indexOf("->");if(s!=-1)t=t.substr(s+2);else{var r=t.indexOf("<-");r!=-1&&(t=t.substr(0,r))}}return t},parseLinks:function(t,e){var s,r=[],i=/\[\[(.*?)\]\]/g;if(t)for(t=t.replace(/\/\*.*\*\//g,""),t=t.replace(/^\/\/.*(\r\n?|\n)/g,"");null!==(s=i.exec(t));){var n=this.parseLink(s[1]);/^\w+:\/\/\/?\w/i.test(n)||r.push(e+" -> "+(this.settings.showNodeNames?this.scrub(n):this.getIdFromTarget(n)))}return r},rotate:function(){this.settings.rotation=(this.settings.rotation+1)%4,this.convert()},scale:function(){var t=document.getElementsByTagName("svg")[0];t.setAttribute("width","100%"),t.removeAttribute("height")},save:function(t){var e,s=document.getElementById("dotfile").value;if("txt"==t)e=new Blob([s],{type:"text/plain;charset=utf-8"}),filesaver.saveAs(e,"dot"+Date.now()+".txt",!0);else if("svg"==t){var r=Viz(s,"svg").replace("no","yes");e=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),filesaver.saveAs(e,"dotgraph"+Date.now()+".svg",!0)}},scrub:function(t){return t&&(t=t.replace(/"/gm,'\\"').replace(/[^\x00-\x7F]/g,""),t='"'+t+'"'),t},parseSettings:function(){this.settings.checkpoints=!!document.getElementById("checkpointsCheckbox")&&document.getElementById("checkpointsCheckbox").checked,this.settings.cluster=!!document.getElementById("clusterCheckbox")&&document.getElementById("clusterCheckbox").checked,this.settings.colorBW=!!document.getElementById("colorCheckbox0")&&document.getElementById("colorCheckbox0").checked,this.settings.colorByNode=!!document.getElementById("colorCheckbox1")&&document.getElementById("colorCheckbox1").checked,this.settings.colorByTag=!!document.getElementById("colorCheckbox2")&&document.getElementById("colorCheckbox2").checked,this.settings.ends=!!document.getElementById("endsCheckbox")&&document.getElementById("endsCheckbox").checked,this.settings.showNodeNames=!!document.getElementById("nodeCheckbox")&&document.getElementById("nodeCheckbox").checked},parseStory:function(){var t,e,s=window.document.getElementById("storeArea"),r=window.document.getElementsByTagName("tw-storydata");if(s){var i="Untitled Story";s.querySelectorAll('[tiddler="StoryTitle"]').length&&(i=s.querySelectorAll('[tiddler="StoryTitle"]')[0].innerText,s.removeChild(s.querySelectorAll('[tiddler="StoryTitle"]')[0])),this.story.title=this.scrub(i),s.querySelectorAll('[tiddler="StoryAuthor"]').length&&s.removeChild(s.querySelectorAll('[tiddler="StoryAuthor"]')[0]),s.querySelectorAll('[tiddler="StorySubtitle"]').length&&s.removeChild(s.querySelectorAll('[tiddler="StorySubtitle"]')[0]),s.querySelectorAll('[tiddler="StoryMenu"]').length&&s.removeChild(s.querySelectorAll('[tiddler="StoryMenu"]')[0]),s.querySelectorAll('[tiddler="StorySettings"]').length&&s.removeChild(s.querySelectorAll('[tiddler="StorySettings"]')[0]),s.querySelectorAll('[tiddler="StoryIncludes"]').length&&s.removeChild(s.querySelectorAll('[tiddler="StoryIncludes"]')[0]),e=s.querySelectorAll("div[tiddler]")}else r?(this.story.title=this.scrub(r[0].getAttribute("name")),this.story.startNode=r[0].getAttribute("startnode"),e=document.querySelectorAll("tw-passagedata")):(this.story.title="Untitled",this.story.startNode=1,e=document.querySelectorAll("tw-passagedata"));for(t=0;t<e.length;t++)s&&"Start"==e[t].getAttribute("tiddler")&&(this.story.startNode=t),this.story.passages[t]={},this.story.passages[t].content=e[t].innerText,this.story.passages[t].textLength=this.story.passages[t].content.length,this.story.passages[t].pid=e[t].getAttribute("pid")?e[t].getAttribute("pid"):t,this.story.passages[t].tagArray=e[t].getAttribute("tags")?e[t].getAttribute("tags").split(" "):[],this.story.passages[t].name=e[t].getAttribute("name")?e[t].getAttribute("name"):e[t].getAttribute("tiddler")?e[t].getAttribute("tiddler"):"Untitled Passage",this.story.passages[t].scrubbedTitle=this.parsePassageName(this.story.passages[t],!0),this.story.passages[t].scrubbedTitleOrPid=this.parsePassageName(this.story.passages[t]);for(this.story.leaves=0,this.story.links=0,this.story.tightEnds=0,this.story.tagObject={},this.story.tags=[],this.story.targets={},t=0;t<this.story.passages.length;t++)this.story.passages[t].textLength>this.story.maxLength&&(this.story.maxLength=this.story.passages[t].textLength),this.settings.ends&&this.hasTag(this.story.passages[t],this.settings.endTag)&&this.story.tightEnds++,this.story.passages[t].pid==this.story.startNode&&(this.story.startNodeName=this.story.passages[t].scrubbedTitleOrPid),this.story.passages[t].firstTag=this.getFirstTag(this.story.passages[t]),this.story.passages[t].firstTag&&(this.story.tagObject.hasOwnProperty(this.story.passages[t].firstTag)||(this.story.tagObject[this.story.passages[t].firstTag]=[],this.story.tags.push(this.story.passages[t].firstTag)),this.story.tagObject[this.story.passages[t].firstTag].push(this.story.passages[t].scrubbedTitleOrPid)),this.story.targets[this.story.passages[t].scrubbedTitle]=this.story.passages[t].pid},writeClusterCode:function(t){var e="",s=0;for(var r in t)t.hasOwnProperty(r)&&(e+="subgraph cluster_"+s+" {\r\n",e+="label="+this.scrub(r)+"\r\n",e+='style="rounded, filled" fillcolor="ivory"\r\n',e+=t[r].join(" \r\n")+"}\r\n\r\n",s++);return e},writeTagKey:function(t,e){for(var s,r='{rank=source\r\nstyle="rounded, filled"\r\n',i=0;i<t.tags.length;i++)s=this.scrub(this.story.tags[i]),r+=s+" [shape=rect ",r+='style="filled,rounded" fillcolor="'+e.palette[i%26]+'"]\r\n';r+="}\r\n";var n=e.showNodeNames?t.startNodeName:t.startNode;for(i=0;i<t.tags.length;i++)r+=this.scrub(t.tags[i])+" -> "+n+" [style=invis]\r\n";return r}}),window.DotGraph.convert()};
},{"filesaver.js-npm":1}]},{},[2]);
</script>
</body>
</html>
